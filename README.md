# 短信验证码转发系统

一个简单的短信验证码转发系统，可以将手机收到的短信验证码实时转发到电脑上显示。

## 系统架构

- **电脑服务端（Python）**：监听TCP连接，接收并显示验证码
- **手机客户端（Android）**：监听短信，自动提取验证码并发送到电脑

## 功能特点

✅ 自动监听短信  
✅ 智能提取验证码（支持多种格式）  
✅ 实时转发到电脑  
✅ 后台服务运行  
✅ 验证码历史记录  
✅ 自动重连机制  

## 环境要求

### 电脑端
- Python 3.6+
- Windows/Linux/MacOS

### 手机端
- Android 6.0 (API 24) 及以上
- 需要授予短信和网络权限

## 安装使用

### 1. 电脑服务端设置

#### 安装Python依赖
```bash
cd "D:\pythonjob\CGB自动认证"
pip install -r requirements.txt
```

#### 启动服务器
```bash
python server.py
```

或指定端口：
```bash
python server.py 9999
```

#### 服务器启动后会显示：
```
============================================================
短信验证码接收服务器已启动
============================================================
监听地址: 0.0.0.0
监听端口: 8888

请在手机客户端中连接到:
  服务器地址: 192.168.1.100
  端口号: 8888

等待客户端连接...
============================================================
```

**记下显示的IP地址和端口，后面手机客户端需要用到。**

### 2. 手机客户端设置

#### 方法一：使用Android Studio编译安装

1. 用Android Studio打开 `android_client` 目录
2. 等待Gradle同步完成
3. 连接手机，确保开启USB调试
4. 点击运行按钮安装应用

#### 方法二：直接安装APK（需要先编译）

```bash
cd android_client
./gradlew assembleDebug
# APK位置：app/build/outputs/apk/debug/app-debug.apk
```

#### 使用步骤

1. **授予权限**  
   首次打开应用，会请求短信和网络权限，请全部允许

2. **配置服务器**  
   - 输入电脑服务端显示的IP地址（如：192.168.1.100）
   - 输入端口号（默认：8888）

3. **连接服务器**  
   点击"连接"按钮，等待连接成功提示

4. **测试**  
   向手机发送一条包含验证码的短信，电脑端会自动接收并显示

## 验证码提取规则

系统支持以下格式的验证码自动提取：

- `验证码是123456`
- `验证码：123456`
- `verification code: 123456`
- `您的验证码 123456`
- 纯6位数字：`123456`
- 纯4位数字：`1234`

## 工作原理

```
┌──────────┐          ┌──────────┐
│  手机端  │          │  电脑端  │
│          │          │          │
│  短信到达 │          │  监听端口 │
│    ↓     │          │    ↓     │
│ 提取验证码│   TCP    │  接收数据 │
│    ↓     │─────────→│    ↓     │
│  JSON封装│          │  解析显示│
│    ↓     │          │    ↓     │
│  发送数据│          │保存到文件│
└──────────┘          └──────────┘
```

### 数据格式（JSON）

```json
{
  "sender": "106900000000",
  "content": "您的验证码是123456，请在5分钟内使用",
  "timestamp": "2025-11-03 15:30:45"
}
```

## 文件说明

### 电脑端
- `server.py` - 服务端主程序
- `config.py` - 配置文件
- `requirements.txt` - Python依赖
- `verification_codes.txt` - 验证码历史记录（自动生成）

### 手机端
```
android_client/
├── app/
│   ├── src/main/
│   │   ├── java/com/example/smsforwarder/
│   │   │   ├── MainActivity.kt          # 主界面
│   │   │   ├── SmsReceiver.kt           # 短信接收器
│   │   │   └── SmsForwarderService.kt   # 后台服务
│   │   ├── res/                         # 资源文件
│   │   └── AndroidManifest.xml          # 清单文件
│   └── build.gradle                     # 应用配置
├── build.gradle                         # 项目配置
└── settings.gradle                      # 项目设置
```

## 常见问题

### 1. 手机无法连接到电脑？

**检查网络：**
- 确保手机和电脑在同一个WiFi网络下
- 检查电脑防火墙是否阻止了端口（8888）

**Windows防火墙设置：**
```powershell
# 允许入站连接（以管理员身份运行PowerShell）
New-NetFirewallRule -DisplayName "SMS Forwarder" -Direction Inbound -Protocol TCP -LocalPort 8888 -Action Allow
```

### 2. 收到短信但电脑没有显示？

- 检查手机客户端是否处于"已连接"状态
- 查看手机应用的"转发日志"是否有记录
- 重启手机应用和电脑服务端

### 3. 验证码提取不准确？

可以修改 `config.py` 中的 `CODE_PATTERNS` 添加自定义规则：

```python
CODE_PATTERNS = [
    r'您的验证码是(\d{6})',  # 自定义规则
    # ... 其他规则
]
```

### 4. 手机后台被杀？

在手机设置中：
- 关闭电池优化
- 允许后台运行
- 加入白名单

不同品牌手机设置位置：
- 小米：设置 → 省电与电池 → 应用智能省电 → 选择应用 → 无限制
- 华为：设置 → 应用和服务 → 应用启动管理 → 手动管理
- OPPO：设置 → 电池 → 应用耗电管理 → 允许后台运行

### 5. 如何查看历史验证码？

电脑端会自动保存到 `verification_codes.txt` 文件，格式：
```
2025-11-03 15:30:45 | 106900000000 | 123456 | 您的验证码是123456
```

## 安全说明

⚠️ **重要提示：**

1. 该系统仅供个人使用，请勿用于非法用途
2. 短信内容未加密传输，请仅在可信网络环境使用
3. 建议仅在局域网内使用，不要暴露到公网
4. 验证码属于敏感信息，请妥善保管历史记录文件

## 进阶使用

### 修改监听端口

编辑 `config.py`：
```python
SERVER_PORT = 9999  # 修改为你想要的端口
```

### 自定义验证码匹配规则

编辑 `server.py` 的 `extract_verification_code` 方法，添加自定义正则表达式。

### 开机自启动（电脑端）

**Windows：**
1. 创建 `start_server.bat` 文件：
```batch
@echo off
cd /d "D:\pythonjob\CGB自动认证"
python server.py
pause
```
2. 将快捷方式放到启动文件夹：`Win+R` 输入 `shell:startup`

**Linux/MacOS：**
创建systemd服务或使用crontab

## 技术栈

- **电脑端**：Python 3, Socket编程, JSON
- **手机端**：Kotlin, Android SDK, Coroutines, Material Design

## 许可

本项目仅供学习和个人使用。

## 联系方式

如有问题或建议，欢迎反馈。

---

**享受自动化的便利！** 🎉

